<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kalshi Interest Rate Hedging Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: .5; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // Kalshi contract fee structure
    const KALSHI_FEES = {
      tradingFee: 0.035, // 3.5 cents per contract on each side
      settlementFee: 0.035, // 3.5 cents per contract on winning side
      maxFeePerContract: 0.07 // Maximum 7 cents total per contract
    };

    // Sample market data (in production, this would come from Kalshi API)
    const SAMPLE_MARKETS = [
      { cuts: 0, probability: 0.15, price: 15 },
      { cuts: 1, probability: 0.25, price: 25 },
      { cuts: 2, probability: 0.30, price: 30 },
      { cuts: 3, probability: 0.20, price: 20 },
      { cuts: 4, probability: 0.07, price: 7 },
      { cuts: 5, probability: 0.03, price: 3 },
    ];

    function HedgingCalculator() {
      // Input states
      const [loanAmount, setLoanAmount] = useState(500000);
      const [currentRate, setCurrentRate] = useState(7.5);
      const [refinanceThreshold, setRefinanceThreshold] = useState(6.5);
      const [refinanceCost, setRefinanceCost] = useState(5000);
      const [monthlyPayment, setMonthlyPayment] = useState(0);
      const [hedgeAmount, setHedgeAmount] = useState(10000);
      
      // UI states
      const [inputsComplete, setInputsComplete] = useState(false);
      const [showStrategy, setShowStrategy] = useState(false);
      
      // Market data (would be fetched from API)
      const [markets, setMarkets] = useState(SAMPLE_MARKETS);

      // Calculate monthly payment
      useEffect(() => {
        const r = currentRate / 100 / 12;
        const n = 30 * 12;
        const payment = loanAmount * (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
        setMonthlyPayment(payment);
      }, [loanAmount, currentRate]);

      // Calculate number of cuts needed to hit refinance threshold
      const cutsToRefinance = useMemo(() => {
        const rateDiff = currentRate - refinanceThreshold;
        return Math.ceil(rateDiff / 0.25); // Assuming 0.25% per cut
      }, [currentRate, refinanceThreshold]);

      // Calculate potential loss if rates don't drop
      const potentialLoss = useMemo(() => {
        const currentMonthly = monthlyPayment;
        const r = refinanceThreshold / 100 / 12;
        const n = 30 * 12;
        const refinancedPayment = loanAmount * (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
        const monthlySavings = currentMonthly - refinancedPayment;
        return monthlySavings * 12 * 5; // 5 years of missed savings
      }, [loanAmount, currentRate, refinanceThreshold, monthlyPayment]);

      // Calculate hedge strategy
      const hedgeStrategy = useMemo(() => {
        if (!inputsComplete) return null;

        const strategies = [];
        
        // Only bet against cuts beyond the refinance threshold
        // If we need 3 cuts to refinance, we don't bet against 0, 1, or 2 cuts
        // We bet FOR 0, 1, or 2 cuts happening (meaning rates won't drop enough)
        
        for (let cuts = 0; cuts < cutsToRefinance && cuts < markets.length; cuts++) {
          const market = markets[cuts];
          const contractsNeeded = Math.floor(hedgeAmount / (market.price / 100));
          const totalCost = contractsNeeded * (market.price / 100);
          const tradingFees = contractsNeeded * KALSHI_FEES.tradingFee;
          const settlementFees = contractsNeeded * KALSHI_FEES.settlementFee;
          const totalWithFees = totalCost + tradingFees;
          
          strategies.push({
            cuts,
            probability: market.probability,
            price: market.price,
            contractsNeeded,
            totalCost,
            tradingFees,
            settlementFees,
            totalWithFees,
            payout: contractsNeeded * 1, // $1 per contract
            netProfit: (contractsNeeded * 1) - totalWithFees - settlementFees
          });
        }
        
        return strategies;
      }, [inputsComplete, markets, cutsToRefinance, hedgeAmount]);

      // Calculate scenario outcomes
      const scenarios = useMemo(() => {
        if (!hedgeStrategy) return null;

        const scenarios = [];
        
        // Scenario 1: You don't refinance (0 to threshold cuts happen)
        const noRefiScenarios = [];
        let expectedHedgeValue = 0;
        
        for (let cuts = 0; cuts < cutsToRefinance; cuts++) {
          const strategy = hedgeStrategy.find(s => s.cuts === cuts);
          if (strategy) {
            const scenario = {
              cuts,
              probability: strategy.probability,
              rateAfterCuts: currentRate - (cuts * 0.25),
              hedgeProfit: strategy.netProfit,
              refinanceSavings: 0, // Don't refinance
              netOutcome: strategy.netProfit
            };
            noRefiScenarios.push(scenario);
            expectedHedgeValue += scenario.probability * scenario.netOutcome;
          }
        }
        
        // Scenario 2: You refinance (threshold or more cuts happen)
        const refiProbability = markets
          .filter(m => m.cuts >= cutsToRefinance)
          .reduce((sum, m) => sum + m.probability, 0);
        
        const totalHedgeCost = hedgeStrategy.reduce((sum, s) => sum + s.totalWithFees, 0);
        const refinanceSavings = potentialLoss - refinanceCost;
        
        const refiScenario = {
          probability: refiProbability,
          hedgeLoss: -totalHedgeCost, // Lost all hedge bets
          refinanceSavings: refinanceSavings,
          netOutcome: refinanceSavings - totalHedgeCost
        };
        
        // Overall expected value
        const expectedRefiValue = refiProbability * refiScenario.netOutcome;
        const totalExpectedValue = expectedHedgeValue + expectedRefiValue;
        
        return {
          noRefi: noRefiScenarios,
          refi: refiScenario,
          expectedHedgeValue,
          expectedRefiValue,
          totalExpectedValue,
          hedgeCost: totalHedgeCost
        };
      }, [hedgeStrategy, cutsToRefinance, markets, currentRate, potentialLoss, refinanceCost]);

      const handleInputsComplete = () => {
        if (loanAmount > 0 && currentRate > 0 && refinanceThreshold < currentRate) {
          setInputsComplete(true);
          setTimeout(() => setShowStrategy(true), 500);
        }
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
          {/* Header */}
          <header className="bg-white border-b border-gray-200">
            <div className="max-w-7xl mx-auto px-4 py-6">
              <h1 className="text-3xl font-bold text-gray-900">Kalshi Interest Rate Hedge Calculator</h1>
              <p className="mt-2 text-gray-600">Protect yourself against rising rates using prediction markets</p>
            </div>
          </header>

          {/* Input Section */}
          <div className="max-w-7xl mx-auto px-4 py-8">
            <div className="bg-white rounded-xl shadow-lg p-8">
              <h2 className="text-2xl font-semibold mb-6">Your Mortgage Details</h2>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Loan Amount
                  </label>
                  <div className="relative">
                    <span className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                    <input
                      type="number"
                      value={loanAmount}
                      onChange={(e) => setLoanAmount(Number(e.target.value))}
                      className="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Current Rate (%)
                  </label>
                  <input
                    type="number"
                    step="0.1"
                    value={currentRate}
                    onChange={(e) => setCurrentRate(Number(e.target.value))}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Refinance If Rate Drops To (%)
                  </label>
                  <input
                    type="number"
                    step="0.1"
                    value={refinanceThreshold}
                    onChange={(e) => setRefinanceThreshold(Number(e.target.value))}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Refinance Cost
                  </label>
                  <div className="relative">
                    <span className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                    <input
                      type="number"
                      value={refinanceCost}
                      onChange={(e) => setRefinanceCost(Number(e.target.value))}
                      className="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Hedge Investment Amount
                  </label>
                  <div className="relative">
                    <span className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                    <input
                      type="number"
                      value={hedgeAmount}
                      onChange={(e) => setHedgeAmount(Number(e.target.value))}
                      className="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Current Monthly Payment
                  </label>
                  <div className="text-2xl font-bold text-gray-900">
                    ${monthlyPayment.toFixed(2)}
                  </div>
                </div>
              </div>

              <button
                onClick={handleInputsComplete}
                className="mt-8 w-full md:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors"
              >
                Calculate Hedge Strategy
              </button>
            </div>

            {/* Risk Alert Box */}
            {inputsComplete && (
              <div className="mt-8 fade-in">
                <div className="bg-red-50 border-l-4 border-red-500 p-6 rounded-lg">
                  <div className="flex items-start">
                    <div className="flex-shrink-0">
                      <svg className="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                      </svg>
                    </div>
                    <div className="ml-3">
                      <h3 className="text-lg font-semibold text-red-900">
                        You stand to lose ${potentialLoss.toFixed(0)} over 5 years
                      </h3>
                      <p className="mt-2 text-red-700">
                        If the Fed doesn't cut rates by {(currentRate - refinanceThreshold).toFixed(2)}% to reach your refinance threshold of {refinanceThreshold}%
                      </p>
                    </div>
                  </div>
                </div>

                <div className="mt-4 bg-green-50 border-l-4 border-green-500 p-6 rounded-lg fade-in">
                  <div className="flex items-start">
                    <div className="flex-shrink-0">
                      <svg className="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                    </div>
                    <div className="ml-3">
                      <h3 className="text-lg font-semibold text-green-900">
                        You could protect yourself with Kalshi
                      </h3>
                      <p className="mt-2 text-green-700">
                        By investing ${hedgeAmount} in contracts betting against sufficient rate cuts, you could earn up to ${hedgeStrategy && hedgeStrategy[0] ? hedgeStrategy[0].netProfit.toFixed(0) : '...'} if rates stay high
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* Strategy Section */}
            {showStrategy && hedgeStrategy && scenarios && (
              <div className="mt-8 space-y-8 fade-in">
                {/* Hedge Strategy */}
                <div className="bg-white rounded-xl shadow-lg p-8">
                  <h2 className="text-2xl font-semibold mb-6">Hedge Strategy</h2>
                  <p className="text-gray-600 mb-6">
                    Buy contracts betting on fewer than {cutsToRefinance} rate cuts. You win if rates don't drop enough to refinance.
                  </p>
                  
                  <div className="space-y-4">
                    {hedgeStrategy.map((strategy) => (
                      <div key={strategy.cuts} className="border border-gray-200 rounded-lg p-4">
                        <div className="flex justify-between items-start">
                          <div>
                            <h4 className="font-semibold text-lg">
                              {strategy.cuts === 0 ? 'No cuts' : `${strategy.cuts} cut${strategy.cuts > 1 ? 's' : ''}`}
                            </h4>
                            <p className="text-sm text-gray-500 mt-1">
                              Probability: {(strategy.probability * 100).toFixed(0)}% | Price: {strategy.price}¢
                            </p>
                          </div>
                          <div className="text-right">
                            <p className="font-semibold text-green-600">
                              +${strategy.netProfit.toFixed(2)}
                            </p>
                            <p className="text-xs text-gray-500">
                              if this happens
                            </p>
                          </div>
                        </div>
                        <div className="mt-3 grid grid-cols-3 gap-4 text-sm">
                          <div>
                            <span className="text-gray-500">Contracts:</span>
                            <span className="ml-2 font-medium">{strategy.contractsNeeded}</span>
                          </div>
                          <div>
                            <span className="text-gray-500">Cost:</span>
                            <span className="ml-2 font-medium">${strategy.totalCost.toFixed(2)}</span>
                          </div>
                          <div>
                            <span className="text-gray-500">Fees:</span>
                            <span className="ml-2 font-medium">${(strategy.tradingFees + strategy.settlementFees).toFixed(2)}</span>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Scenario Analysis */}
                <div className="bg-white rounded-xl shadow-lg p-8">
                  <h2 className="text-2xl font-semibold mb-6">Scenario Analysis</h2>
                  
                  {/* Scenario 1: No Refinance */}
                  <div className="mb-8">
                    <h3 className="text-xl font-semibold mb-4 text-blue-700">
                      Scenario 1: You Don't Refinance ({(scenarios.noRefi.reduce((sum, s) => sum + s.probability, 0) * 100).toFixed(0)}% chance)
                    </h3>
                    <p className="text-gray-600 mb-4">Rates don't drop enough to hit your {refinanceThreshold}% threshold</p>
                    
                    <div className="bg-blue-50 rounded-lg p-4">
                      <table className="w-full">
                        <thead>
                          <tr className="text-left text-sm font-medium text-gray-700">
                            <th className="pb-2">Rate Cuts</th>
                            <th className="pb-2">Probability</th>
                            <th className="pb-2">New Rate</th>
                            <th className="pb-2">Hedge Profit</th>
                          </tr>
                        </thead>
                        <tbody>
                          {scenarios.noRefi.map((scenario) => (
                            <tr key={scenario.cuts} className="border-t border-blue-100">
                              <td className="py-2">{scenario.cuts} cuts</td>
                              <td className="py-2">{(scenario.probability * 100).toFixed(0)}%</td>
                              <td className="py-2">{scenario.rateAfterCuts.toFixed(2)}%</td>
                              <td className="py-2 font-semibold text-green-600">
                                +${scenario.hedgeProfit.toFixed(2)}
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                      <div className="mt-4 pt-4 border-t border-blue-200">
                        <div className="flex justify-between font-semibold">
                          <span>Expected Value (No Refi):</span>
                          <span className="text-green-600">+${scenarios.expectedHedgeValue.toFixed(2)}</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Scenario 2: Refinance */}
                  <div>
                    <h3 className="text-xl font-semibold mb-4 text-purple-700">
                      Scenario 2: You Refinance ({(scenarios.refi.probability * 100).toFixed(0)}% chance)
                    </h3>
                    <p className="text-gray-600 mb-4">Rates drop to {refinanceThreshold}% or lower</p>
                    
                    <div className="bg-purple-50 rounded-lg p-4">
                      <div className="space-y-3">
                        <div className="flex justify-between">
                          <span className="text-gray-700">Hedge Losses:</span>
                          <span className="font-semibold text-red-600">${scenarios.refi.hedgeLoss.toFixed(2)}</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-gray-700">Refinance Savings (5 years):</span>
                          <span className="font-semibold text-green-600">+${scenarios.refi.refinanceSavings.toFixed(2)}</span>
                        </div>
                        <div className="pt-3 border-t border-purple-200 flex justify-between font-semibold">
                          <span>Net Outcome:</span>
                          <span className={scenarios.refi.netOutcome >= 0 ? 'text-green-600' : 'text-red-600'}>
                            ${scenarios.refi.netOutcome >= 0 ? '+' : ''}{scenarios.refi.netOutcome.toFixed(2)}
                          </span>
                        </div>
                        <div className="pt-3 border-t border-purple-200 flex justify-between">
                          <span className="text-gray-700">Expected Value (Refi):</span>
                          <span className="font-semibold">
                            ${scenarios.expectedRefiValue >= 0 ? '+' : ''}{scenarios.expectedRefiValue.toFixed(2)}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Overall Expected Value */}
                  <div className="mt-8 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg p-6 text-white">
                    <h3 className="text-xl font-semibold mb-2">Overall Expected Outcome</h3>
                    <div className="flex justify-between items-center">
                      <div>
                        <p className="text-indigo-100 mb-1">Cost of Hedge: ${scenarios.hedgeCost.toFixed(2)}</p>
                        <p className="text-indigo-100">Protection Against: ${potentialLoss.toFixed(0)} loss</p>
                      </div>
                      <div className="text-right">
                        <p className="text-sm text-indigo-100 mb-1">Expected Value</p>
                        <p className="text-3xl font-bold">
                          ${scenarios.totalExpectedValue >= 0 ? '+' : ''}{scenarios.totalExpectedValue.toFixed(2)}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Math Explained */}
                <div className="bg-white rounded-xl shadow-lg p-8">
                  <h2 className="text-2xl font-semibold mb-6">The Math Explained</h2>
                  
                  <div className="space-y-6">
                    <div>
                      <h3 className="font-semibold text-lg mb-2">1. Why This Strategy Works</h3>
                      <p className="text-gray-600">
                        You're essentially buying insurance against rates staying high. You only bet on scenarios where rates 
                        don't drop enough to refinance (fewer than {cutsToRefinance} cuts). If rates stay high, you win your bets 
                        and offset the opportunity cost. If rates drop enough to refinance, you lose the bets but save much more 
                        from refinancing.
                      </p>
                    </div>

                    <div>
                      <h3 className="font-semibold text-lg mb-2">2. Contract Fees Impact</h3>
                      <p className="text-gray-600">
                        Kalshi charges {(KALSHI_FEES.tradingFee * 100).toFixed(1)} cents per contract when you buy, and 
                        another {(KALSHI_FEES.settlementFee * 100).toFixed(1)} cents when you win. These fees reduce your 
                        net profit by approximately {((KALSHI_FEES.maxFeePerContract / 1) * 100).toFixed(0)}% per contract.
                      </p>
                    </div>

                    <div>
                      <h3 className="font-semibold text-lg mb-2">3. Expected Value Calculation</h3>
                      <p className="text-gray-600">
                        Expected Value = Σ(Probability × Outcome) for all scenarios
                      </p>
                      <div className="mt-2 p-3 bg-gray-50 rounded font-mono text-sm">
                        <p>EV = {scenarios.noRefi.map((s, i) => `(${(s.probability * 100).toFixed(0)}% × $${s.netOutcome.toFixed(0)})`).join(' + ')}</p>
                        <p className="mt-1">+ ({(scenarios.refi.probability * 100).toFixed(0)}% × ${scenarios.refi.netOutcome.toFixed(0)})</p>
                        <p className="mt-1 font-bold">= ${scenarios.totalExpectedValue.toFixed(2)}</p>
                      </div>
                    </div>

                    <div>
                      <h3 className="font-semibold text-lg mb-2">4. Break-Even Analysis</h3>
                      <p className="text-gray-600">
                        Your hedge costs ${scenarios.hedgeCost.toFixed(2)}. This is worth it if the probability of rates 
                        staying high multiplied by your potential loss exceeds this cost. In your case, there's 
                        a {(scenarios.noRefi.reduce((sum, s) => sum + s.probability, 0) * 100).toFixed(0)}% chance of 
                        avoiding a ${potentialLoss.toFixed(0)} opportunity loss.
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>

          {/* Footer */}
          <footer className="mt-16 bg-gray-800 text-white py-8">
            <div className="max-w-7xl mx-auto px-4 text-center">
              <p className="text-gray-400">
                This calculator is for educational purposes only. Always consult with financial advisors before making investment decisions.
              </p>
              <p className="mt-2 text-sm text-gray-500">
                Contract fees and probabilities are estimates. Actual Kalshi markets may differ.
              </p>
            </div>
          </footer>
        </div>
      );
    }

    // Render the app
    ReactDOM.render(<HedgingCalculator />, document.getElementById('root'));
  </script>
</body>
</html>