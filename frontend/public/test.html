<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalshi Market Tools</title>
    <!-- React 17 (more stable for CDN) -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .tab-active { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
        .market-card:hover { box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 1000px 100%; animation: loading 2s infinite; }
        @keyframes loading { 0% { background-position: -1000px 0; } 100% { background-position: 1000px 0; } }
    </style>
</head>
<body>
<div id="root">Loading...</div>

<script type="text/babel">
// Log to help debug
console.log('Starting Kalshi Market Tools...');

const { useState, useEffect, useMemo } = React;

// ==================== MOCK DATA ====================
const MockData = {
    markets: [
        { ticker: 'POTUS-24', title: 'Will the incumbent win the 2024 Presidential Election?', category: 'Politics', volume: 5432, yes_price: 52, no_price: 48, yes_bid: 51, yes_ask: 53, no_bid: 47, no_ask: 49, volatility: 7.2 },
        { ticker: 'FED-MAR', title: 'Will the Fed raise rates in March?', category: 'Economics', volume: 3211, yes_price: 65, no_price: 35, yes_bid: 64, yes_ask: 66, no_bid: 34, no_ask: 36, volatility: 5.8 },
        { ticker: 'NFL-SB', title: 'Will the Chiefs win the Super Bowl?', category: 'Sports', volume: 8765, yes_price: 35, no_price: 65, yes_bid: 34, yes_ask: 36, no_bid: 64, no_ask: 66, volatility: 8.9 },
        { ticker: 'HURR-5', title: 'Will there be a Category 5 hurricane this season?', category: 'Weather', volume: 2109, yes_price: 23, no_price: 77, yes_bid: 22, yes_ask: 24, no_bid: 76, no_ask: 78, volatility: 4.3 },
        { ticker: 'TSLA-500', title: 'Will Tesla stock reach $500 by year end?', category: 'Technology', volume: 6543, yes_price: 41, no_price: 59, yes_bid: 40, yes_ask: 42, no_bid: 58, no_ask: 60, volatility: 6.7 },
        { ticker: 'CPI-3', title: 'Will inflation exceed 3% this quarter?', category: 'Economics', volume: 4321, yes_price: 58, no_price: 42, yes_bid: 57, yes_ask: 59, no_bid: 41, no_ask: 43, volatility: 5.2 },
        { ticker: 'CONG-BILL', title: 'Will Congress pass the infrastructure bill?', category: 'Politics', volume: 3456, yes_price: 71, no_price: 29, yes_bid: 70, yes_ask: 72, no_bid: 28, no_ask: 30, volatility: 6.8 },
        { ticker: 'BTC-100K', title: 'Will Bitcoin reach $100,000 this year?', category: 'Technology', volume: 9876, yes_price: 31, no_price: 69, yes_bid: 30, yes_ask: 32, no_bid: 68, no_ask: 70, volatility: 9.1 }
    ],
    
    generateImpact: (quantity, side, market) => ({
        avg_price: market.yes_price + (quantity / 1000) * 1.5,
        total_cost: quantity * (market.yes_price / 100) * 1.02,
        slippage: Math.min(5, quantity / 500),
        fill_rate: Math.max(50, 100 - (quantity / 100)),
        levels_consumed: [
            { price: market.yes_price, filled: Math.min(quantity, 200), remaining: Math.max(0, 200 - quantity) },
            { price: market.yes_price + 1, filled: Math.min(Math.max(0, quantity - 200), 300), remaining: Math.max(0, 300 - Math.max(0, quantity - 200)) },
            { price: market.yes_price + 2, filled: Math.max(0, quantity - 500), remaining: 500 }
        ]
    }),
    
    generateVelocity: (market) => ({
        metrics: {
            total_volume: market.volume * 24,
            recent_avg: Math.floor(market.volume * 1.3),
            earlier_avg: Math.floor(market.volume * 0.9),
            velocity_change: 44.4
        },
        peak: {
            hour: '14:00',
            volume: market.volume * 2.5,
            coincided_with_news: Math.random() > 0.5
        },
        news_events: Math.random() > 0.5 ? [
            {
                timestamp: new Date().toISOString(),
                description: 'Fed announces surprise rate decision',
                volume_spike: market.volume * 2,
                price_at_event: market.yes_price
            }
        ] : []
    })
};

// ==================== COMPONENTS ====================

// Market Card Component
function MarketCard({ market, isSelected, onClick }) {
    const getVolatilityColor = (vol) => {
        if (vol > 8) return 'bg-red-100 text-red-600';
        if (vol > 6) return 'bg-yellow-100 text-yellow-600';
        return 'bg-green-100 text-green-600';
    };

    return (
        <div 
            onClick={onClick}
            className={`market-card p-4 rounded-lg border-2 cursor-pointer transition-all ${
                isSelected ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
            }`}
        >
            <div className="flex justify-between items-start mb-2">
                <span className="font-mono text-sm text-gray-500">{market.ticker}</span>
                <span className={`text-xs px-2 py-1 rounded-full ${getVolatilityColor(market.volatility)}`}>
                    σ{market.volatility}
                </span>
            </div>
            <h4 className="font-medium text-sm mb-2">{market.title}</h4>
            <div className="flex justify-between items-center text-xs text-gray-500">
                <span>{market.volume.toLocaleString()} vol</span>
                <span className="bg-gray-100 px-2 py-1 rounded">{market.category}</span>
            </div>
        </div>
    );
}

// Market Header Component
function MarketHeader({ market }) {
    if (!market) return null;
    
    return (
        <div className="bg-white rounded-lg shadow p-6 mb-6">
            <div className="mb-4">
                <p className="text-sm text-gray-500 font-mono">{market.ticker}</p>
                <h2 className="text-2xl font-bold">{market.title}</h2>
            </div>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div>
                    <p className="text-xs text-gray-500">YES Price</p>
                    <p className="text-2xl font-bold text-green-600">{market.yes_price}¢</p>
                    <p className="text-xs text-gray-400">B: {market.yes_bid}¢ / A: {market.yes_ask}¢</p>
                </div>
                <div>
                    <p className="text-xs text-gray-500">NO Price</p>
                    <p className="text-2xl font-bold text-red-600">{market.no_price}¢</p>
                    <p className="text-xs text-gray-400">B: {market.no_bid}¢ / A: {market.no_ask}¢</p>
                </div>
                <div>
                    <p className="text-xs text-gray-500">Volume</p>
                    <p className="text-xl font-semibold">{market.volume.toLocaleString()}</p>
                </div>
                <div>
                    <p className="text-xs text-gray-500">Spread</p>
                    <p className="text-xl font-semibold">
                        {((market.yes_ask - market.yes_bid) / market.yes_price * 100).toFixed(1)}%
                    </p>
                </div>
            </div>
        </div>
    );
}

// Impact Calculator Component
function ImpactCalculator({ market }) {
    const [side, setSide] = useState('yes');
    const [quantity, setQuantity] = useState(100);
    const [impact, setImpact] = useState(null);
    
    useEffect(() => {
        if (market) {
            const data = MockData.generateImpact(quantity, side, market);
            setImpact(data);
        }
    }, [market, quantity, side]);
    
    if (!market) {
        return (
            <div className="text-center py-12 text-gray-500">
                <p className="text-xl">Select a market to calculate order impact</p>
            </div>
        );
    }
    
    return (
        <div>
            <MarketHeader market={market} />
            
            <div className="bg-white rounded-lg shadow p-6 mb-6">
                <h3 className="text-lg font-semibold mb-4">Order Configuration</h3>
                <div className="space-y-4">
                    <div>
                        <label className="text-sm font-medium text-gray-700">Side</label>
                        <div className="flex gap-2 mt-1">
                            <button
                                onClick={() => setSide('yes')}
                                className={`flex-1 py-2 rounded-lg font-medium transition ${
                                    side === 'yes' ? 'bg-green-500 text-white' : 'bg-gray-100'
                                }`}
                            >
                                YES
                            </button>
                            <button
                                onClick={() => setSide('no')}
                                className={`flex-1 py-2 rounded-lg font-medium transition ${
                                    side === 'no' ? 'bg-red-500 text-white' : 'bg-gray-100'
                                }`}
                            >
                                NO
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label className="text-sm font-medium text-gray-700">
                            Order Size: {quantity} contracts
                        </label>
                        <input
                            type="range"
                            min="10"
                            max="2000"
                            step="10"
                            value={quantity}
                            onChange={(e) => setQuantity(parseInt(e.target.value))}
                            className="w-full mt-2"
                        />
                    </div>
                </div>
            </div>
            
            {impact && (
                <>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div className="bg-blue-50 p-4 rounded-lg">
                            <p className="text-sm text-gray-600">Avg Price</p>
                            <p className="text-2xl font-bold text-blue-600">{impact.avg_price.toFixed(1)}¢</p>
                        </div>
                        <div className="bg-purple-50 p-4 rounded-lg">
                            <p className="text-sm text-gray-600">Total Cost</p>
                            <p className="text-2xl font-bold text-purple-600">${impact.total_cost.toFixed(2)}</p>
                        </div>
                        <div className="bg-orange-50 p-4 rounded-lg">
                            <p className="text-sm text-gray-600">Slippage</p>
                            <p className="text-2xl font-bold text-orange-600">{impact.slippage.toFixed(1)}%</p>
                        </div>
                        <div className="bg-green-50 p-4 rounded-lg">
                            <p className="text-sm text-gray-600">Fill Rate</p>
                            <p className="text-2xl font-bold text-green-600">{impact.fill_rate.toFixed(0)}%</p>
                        </div>
                    </div>
                    
                    <div className="bg-white rounded-lg shadow p-6">
                        <h3 className="text-lg font-semibold mb-4">Orderbook Consumption</h3>
                        <div className="space-y-2">
                            {impact.levels_consumed.map((level, i) => (
                                <div key={i} className="flex justify-between items-center p-3 bg-gray-50 rounded">
                                    <span className="font-mono">@ {level.price}¢</span>
                                    <span>
                                        <span className="text-green-600">{level.filled} filled</span>
                                        {level.remaining > 0 && (
                                            <span className="text-gray-500 ml-2">({level.remaining} remain)</span>
                                        )}
                                    </span>
                                </div>
                            ))}
                        </div>
                    </div>
                </>
            )}
        </div>
    );
}

// Volume Velocity Component
function VolumeVelocity({ market }) {
    const [data, setData] = useState(null);
    
    useEffect(() => {
        if (market) {
            setData(MockData.generateVelocity(market));
        }
    }, [market]);
    
    if (!market) {
        return (
            <div className="text-center py-12 text-gray-500">
                <p className="text-xl">Select a market to analyze volume velocity</p>
            </div>
        );
    }
    
    if (!data) return null;
    
    return (
        <div>
            <MarketHeader market={market} />
            
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div className="bg-blue-50 p-4 rounded-lg">
                    <p className="text-sm text-gray-600">Total Volume</p>
                    <p className="text-2xl font-bold text-blue-600">{data.metrics.total_volume.toLocaleString()}</p>
                </div>
                <div className="bg-purple-50 p-4 rounded-lg">
                    <p className="text-sm text-gray-600">Recent Avg</p>
                    <p className="text-2xl font-bold text-purple-600">{data.metrics.recent_avg.toLocaleString()}</p>
                </div>
                <div className="bg-orange-50 p-4 rounded-lg">
                    <p className="text-sm text-gray-600">Earlier Avg</p>
                    <p className="text-2xl font-bold text-orange-600">{data.metrics.earlier_avg.toLocaleString()}</p>
                </div>
                <div className="bg-green-50 p-4 rounded-lg">
                    <p className="text-sm text-gray-600">Velocity Change</p>
                    <p className="text-2xl font-bold text-green-600">+{data.metrics.velocity_change}%</p>
                </div>
            </div>
            
            {data.news_events.length > 0 && (
                <div className="mb-6">
                    <h3 className="text-lg font-semibold mb-3">Detected News Events</h3>
                    {data.news_events.map((event, i) => (
                        <div key={i} className="bg-amber-50 border-l-4 border-amber-500 p-4 rounded">
                            <p className="font-semibold text-amber-900">{event.description}</p>
                            <p className="text-sm text-gray-600 mt-1">
                                Volume spike: {event.volume_spike.toLocaleString()} • Price: {event.price_at_event}¢
                            </p>
                        </div>
                    ))}
                </div>
            )}
            
            <div className="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-lg">
                <h3 className="text-lg font-semibold mb-2">Peak Activity</h3>
                <p className="text-3xl font-bold">{data.peak.volume.toLocaleString()}</p>
                <p className="text-sm opacity-90">
                    Peak at {data.peak.hour} • {data.peak.coincided_with_news ? '📰 News-driven' : '⚡ Speculation'}
                </p>
            </div>
        </div>
    );
}

// Comparison Component
function Comparison({ markets }) {
    const [selected, setSelected] = useState([]);
    
    const toggle = (market) => {
        if (selected.find(m => m.ticker === market.ticker)) {
            setSelected(selected.filter(m => m.ticker !== market.ticker));
        } else if (selected.length < 4) {
            setSelected([...selected, market]);
        }
    };
    
    return (
        <div>
            <div className="bg-white rounded-lg shadow p-6 mb-6">
                <h3 className="text-lg font-semibold mb-4">Select Markets to Compare (Max 4)</h3>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                    {markets.map(market => (
                        <button
                            key={market.ticker}
                            onClick={() => toggle(market)}
                            className={`p-3 rounded-lg border-2 transition ${
                                selected.find(m => m.ticker === market.ticker)
                                    ? 'border-blue-500 bg-blue-50'
                                    : 'border-gray-200'
                            }`}
                        >
                            <p className="font-mono text-xs">{market.ticker}</p>
                            <p className="text-sm">{market.title.substring(0, 40)}...</p>
                        </button>
                    ))}
                </div>
            </div>
            
            {selected.length > 1 && (
                <div className="bg-white rounded-lg shadow overflow-hidden">
                    <table className="w-full">
                        <thead className="bg-gray-50">
                            <tr>
                                <th className="px-4 py-3 text-left">Market</th>
                                <th className="px-4 py-3 text-center">Price</th>
                                <th className="px-4 py-3 text-center">Volume</th>
                                <th className="px-4 py-3 text-center">Volatility</th>
                            </tr>
                        </thead>
                        <tbody>
                            {selected.map(market => (
                                <tr key={market.ticker} className="border-t">
                                    <td className="px-4 py-3 font-mono text-sm">{market.ticker}</td>
                                    <td className="px-4 py-3 text-center text-green-600 font-bold">{market.yes_price}¢</td>
                                    <td className="px-4 py-3 text-center">{market.volume.toLocaleString()}</td>
                                    <td className="px-4 py-3 text-center">{market.volatility}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            )}
        </div>
    );
}

// Main App Component
function App() {
    const [activeTab, setActiveTab] = useState('impact');
    const [markets] = useState(MockData.markets);
    const [selectedMarket, setSelectedMarket] = useState(MockData.markets[0]);
    const [searchQuery, setSearchQuery] = useState('');
    
    const filteredMarkets = useMemo(() => {
        if (!searchQuery) return markets;
        const query = searchQuery.toLowerCase();
        return markets.filter(m => 
            m.ticker.toLowerCase().includes(query) || 
            m.title.toLowerCase().includes(query)
        );
    }, [markets, searchQuery]);
    
    return (
        <div className="min-h-screen bg-gray-50">
            {/* Header */}
            <header className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 shadow-lg">
                <h1 className="text-3xl font-bold">Kalshi Market Tools</h1>
                <p className="text-blue-100 mt-1">Advanced analytics for event contract trading</p>
            </header>
            
            {/* Navigation */}
            <nav className="bg-white shadow-sm">
                <div className="flex space-x-8 px-6">
                    <button
                        onClick={() => setActiveTab('impact')}
                        className={`py-4 px-2 font-medium transition ${
                            activeTab === 'impact' ? 'tab-active' : 'text-gray-600'
                        }`}
                    >
                        Market Impact
                    </button>
                    <button
                        onClick={() => setActiveTab('velocity')}
                        className={`py-4 px-2 font-medium transition ${
                            activeTab === 'velocity' ? 'tab-active' : 'text-gray-600'
                        }`}
                    >
                        Volume Velocity
                    </button>
                    <button
                        onClick={() => setActiveTab('comparison')}
                        className={`py-4 px-2 font-medium transition ${
                            activeTab === 'comparison' ? 'tab-active' : 'text-gray-600'
                        }`}
                    >
                        Multi-Market
                    </button>
                </div>
            </nav>
            
            {/* Main Content */}
            <main className="container mx-auto px-6 py-6">
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    {/* Sidebar */}
                    <aside>
                        <div className="bg-white rounded-lg shadow p-4">
                            <h3 className="font-semibold text-lg mb-4">Markets</h3>
                            <input
                                type="text"
                                placeholder="Search markets..."
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg mb-4"
                            />
                            <div className="space-y-2 max-h-96 overflow-y-auto">
                                {filteredMarkets.map(market => (
                                    <MarketCard
                                        key={market.ticker}
                                        market={market}
                                        isSelected={selectedMarket?.ticker === market.ticker}
                                        onClick={() => setSelectedMarket(market)}
                                    />
                                ))}
                            </div>
                        </div>
                    </aside>
                    
                    {/* Content */}
                    <div className="lg:col-span-2">
                        {activeTab === 'impact' && <ImpactCalculator market={selectedMarket} />}
                        {activeTab === 'velocity' && <VolumeVelocity market={selectedMarket} />}
                        {activeTab === 'comparison' && <Comparison markets={filteredMarkets} />}
                    </div>
                </div>
            </main>
        </div>
    );
}

// Render the app
console.log('Rendering app...');
ReactDOM.render(<App />, document.getElementById('root'));
console.log('App rendered successfully!');
</script>
</body>
</html>